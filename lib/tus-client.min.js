!function t(e,r,i){function n(s,u){if(!r[s]){if(!e[s]){var h="function"==typeof require&&require;if(!u&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[s]={exports:{}};e[s][0].call(f.exports,function(t){var r=e[s][1][t];return n(r?r:t)},f,f.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e){(function(r){var i,n,o,s,u,h;("undefined"==typeof jQuery||null===jQuery)&&(i=t("jquery")),null==i&&(i=jQuery),null==r.Q&&(u=t("q")),null!=r.Q&&(u=r.Q),h=t("./ResumableUpload"),s=t("./PolyResumableUpload"),n=t("./CheckFileExists"),o=t("./FileChecksum"),r.gr=r.gr||{},r.gr.polyptychon=r.gr.polyptychon||{},r.gr.polyptychon.tus={upload:function(t,e){var r,i;return r=u.defer(),i=new s(t,e),t.stoppableAction=i,i.fail(function(e,i){return t.stoppableAction=null,r.reject(new Error({error:e,status:i}))}),i.progress(function(e,i,n){var o;return o=(i/n*100).toFixed(2),t.percentage=o,r.notify(o)}),i.done(function(t,e,i){return e.stoppableAction=null,e.percentage=null,e.md5&&i?e.md5===i?r.resolve({url:t,file:e,md5:i}):r.reject(new Error("Checksum does not match. "+e.md5+" != "+i)):(i&&(e.md5=i),t&&(e.url=t),r.resolve({url:t,file:e,md5:i}))}),t&&i._start(),r.promise},check:function(t,e){var r,i;return i=u.defer(),r=new n(t,e),t.stoppableAction=r,t&&r._checkFileExists(),r.fail(function(){return i.resolve(t)}).done(function(t,e){return i.reject({message:"File already exist",file:e})}),i.promise},checksum:function(t,e){var r,i;return i=u.defer(),r=new o(t,e),t.stoppableAction=r,r.fail(function(e){return t.stoppableAction=null,i.reject(new Error(e))}),r.progress(function(e,r,n){var o;return o=(r/n*100).toFixed(2),t.percentage=o,i.notify(o)}),r.done(function(t,e){return t.stoppableAction=null,t.percentage=null,t.md5=e,i.resolve({file:t,md5:e})}),t&&r._computeChecksum(0),i.promise},stop:function(t){return t.stoppableAction&&t.stoppableAction.stop(),u.reject("stop")},checkAll:function(t,e){var r,i,n,o;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],i.push(this.check(r,e));return u.all(i)},checksumAll:function(t,e){var r,i,n,o;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],i.push(this.checksum(r,e));return u.all(i)},uploadAll:function(t,e){var r,i,n,o;for(i=[],n=0,o=t.length;o>n;n++)r=t[n],i.push(this.upload(r,e));return u.all(i)},stopAll:function(t){var e,r,i;for(r=0,i=t.length;i>r;r++)e=t[r],this.stop(e);return u.reject("stop")},UploadSupport:h.SUPPORT},e.exports=r.gr.polyptychon.tus}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./CheckFileExists":2,"./FileChecksum":3,"./PolyResumableUpload":4,"./ResumableUpload":5,jquery:"jquery",q:"q"}],2:[function(t,e){(function(){var r,i;("undefined"==typeof jQuery||null===jQuery)&&(r=t("jquery")),null==r&&(r=jQuery),i=function(){function t(e,i){this.file=e,this.options=r.extend(t.DEFAULTS,i),this.fileUrl=null,this._jqXHR=null,this._deferred=r.Deferred(),this._deferred.promise(this)}return t.DEFAULTS={path:"",headers:{}},t.prototype._checkFileExists=function(){var t,e;return t=r.extend({"file-path":""+this.options.path+"/"+this.file.name},this.options.headers),e={type:"HEAD",url:this.options.endpoint,cache:!1,headers:t},this._jqXHR=r.ajax(e).fail(function(t){return function(e,r){return 404===e.status?t._emitFail("File not found: "+r,e.status):t._emitFail(r,e.status)}}(this)).done(function(t){return function(){return t._emitDone()}}(this))},t.prototype.stop=function(){return null!=this._jqXHR?this._jqXHR.abort():void 0},t.prototype._emitDone=function(){return this._deferred.resolveWith(this,[this.fileUrl,this.file])},t.prototype._emitFail=function(t,e){return this._deferred.rejectWith(this,[t,e])},t}(),e.exports=i}).call(this)},{jquery:"jquery"}],3:[function(t,e){(function(){var r,i,n;("undefined"==typeof jQuery||null===jQuery)&&(r=t("jquery")),null==r&&(r=jQuery),("undefined"==typeof n||null===n)&&(n=t("spark-md5")),i=function(){function t(e,i){this.file=e,this.options=r.extend(t.DEFAULTS,i),(null===this.options.chunkSize||this.options.chunkSize<2097152)&&(this.options.chunkSize=2097152),this.spark=new n,this.fileReader=new FileReader,this.fileReader.onload=function(t){return function(e){return t.spark.appendBinary(e.target.result),t._emitProgress(),t._computeChecksum(t.range_to)}}(this),this.fileReader.onerror=function(t){return function(e){return t._emitFail(e)}}(this),this._deferred=r.Deferred(),this._deferred.promise(this)}return t.DEFAULTS={chunkSize:2097152},t.prototype._computeChecksum=function(t){var e,r,i,n;return this.bytesWritten=t,this.bytesWritten===this.file.size?(this.clientChecksum=this.spark.end(),this._emitDone(),void 0):(i=this.file.size,r=this.options.chunkSize,this.range_to=Math.min(i,t+r),n=this.file.slice||this.file.webkitSlice||this.file.mozSlice,e=n.call(this.file,t,this.range_to,this.file.type),this.fileReader.readAsBinaryString(e))},t.prototype.stop=function(){return this.bytesWritten=this.file.size,this.spark.end(),this._emitFail("FileChecksum stopped!")},t.prototype._emitProgress=function(t){return null==t&&(t=null),this._deferred.notifyWith(this,[t,this.bytesWritten,this.file.size])},t.prototype._emitDone=function(){return this._deferred.resolveWith(this,[this.file,this.clientChecksum])},t.prototype._emitFail=function(t){return this._deferred.rejectWith(this,[t])},t}(),e.exports=i}).call(this)},{jquery:"jquery","spark-md5":6}],4:[function(t,e){(function(){var r,i,n,o={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};("undefined"==typeof jQuery||null===jQuery)&&(r=t("jquery")),null==r&&(r=jQuery),n=t("./ResumableUpload"),i=function(t){function e(t,i){i=r.extend(e.DEFAULTS,i),this._chunkTimer=-1,e.__super__.constructor.call(this,t,i)}return s(e,t),e.DEFAULTS={moveFileAfterUpload:!0,chunkSize:null,minChunkSize:51200,maxChunkSize:2097152,path:""},e.prototype._getChunkSize=function(){var t,e;return this._chunkTimer<0?t=this.options.minChunkSize:(e=(new Date).getTime()-this._chunkTimer,t=Math.round(this.options.chunkSize/e*1e3)),this._chunkTimer=(new Date).getTime(),Math.min(Math.max(this.options.minChunkSize,t),this.options.maxChunkSize)},e.prototype._uploadFile=function(t){return this.options.chunkSize&&(this.options.chunkSize=this._getChunkSize()),e.__super__._uploadFile.call(this,t)},e.prototype._emitDone=function(){return this.options.moveFileAfterUpload?this._moveFile():this._deferred.resolveWith(this,[this.fileUrl,this.file,null])},e.prototype._moveDone=function(t){return this._deferred.resolveWith(this,[this.fileUrl,this.file,t])},e.prototype._moveFile=function(){var t,e;return t=r.extend({"Final-Length":this.file.size,"file-path":""+this.options.path+"/"+this.file.name},this.options.headers),e={type:"PUT",url:this.fileUrl,cache:!1,headers:t},this._jqXHR=r.ajax(e).fail(function(t){return function(e,r){return 404===e.status?t._emitFail("Could not move file resource: "+r,e.status):t._emitFail("Could not head at file resource: "+r,e.status)}}(this)).done(function(t){return function(e,r,i){var n,o;return n=i.getResponseHeader("Checksum"),(o=i.getResponseHeader("Location"))?(t.fileUrl=o,t._moveDone(n)):t._emitFail("Could not get url for file resource. "+r,i.status)}}(this))},e}(n),e.exports=i}).call(this)},{"./ResumableUpload":5,jquery:"jquery"}],5:[function(t,e){(function(){var r,i;("undefined"==typeof jQuery||null===jQuery)&&(r=t("jquery")),null==r&&(r=jQuery),i=function(){function t(e,i){this.file=e,this.options=r.extend(t.DEFAULTS,i),this.fileUrl=null,this.bytesWritten=null,this._jqXHR=null,this._deferred=r.Deferred(),this._deferred.promise(this)}return t.SUPPORT=function(){return!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice)},t.DEFAULTS={resumable:!0,headers:{}},t.prototype._start=function(){return this.options.resumable&&this.options.resetBefore!==!0||this._urlCache(!1),(this.fileUrl=this._urlCache())?this._head():this._post()},t.prototype._post=function(){var t,e;return t=r.extend({"Final-Length":this.file.size},this.options.headers),e={type:"POST",url:this.options.endpoint,headers:t},r.ajax(e).fail(function(t){return function(e,r){return t._emitFail("Could not post to file resource "+t.options.endpoint+". "+r,e.status)}}(this)).done(function(t){return function(e,r,i){var n;return(n=i.getResponseHeader("Location"))?(t.fileUrl=n,t._uploadFile(0)):_emitFail("Could not get url for file resource. "+r,i.status)}}(this))},t.prototype._head=function(){var t;return t={type:"HEAD",url:this.fileUrl,cache:!1,headers:this.options.headers},r.ajax(t).fail(function(t){return function(e,r){return 404===e.status?t._post():t._emitFail("Could not head at file resource: "+r,e.status)}}(this)).done(function(t){return function(e,r,i){var n,o;return o=i.getResponseHeader("Offset"),n=parseInt(o,10)?parseInt(o):0,t._uploadFile(n)}}(this))},t.prototype._uploadFile=function(t){var e,i,n,o,s,u,h;return this.bytesWritten=t,this.bytesWritten===this.file.size?(this._emitProgress(),this._emitDone()):(this._urlCache(this.fileUrl),this._emitProgress(),i=this.bytesWritten,s=this.file.size,this.options.chunkSize&&(s=Math.min(s,t+this.options.chunkSize)),u=this.file.slice||this.file.webkitSlice||this.file.mozSlice,e=u.call(this.file,t,s,this.file.type),h=r.ajaxSettings.xhr(),n=r.extend({Offset:t,"Content-Type":"application/offset+octet-stream"},this.options.headers),o={type:"PATCH",url:this.fileUrl,data:e,processData:!1,contentType:this.file.type,cache:!1,headers:n,xhr:function(){return h}},r(h.upload).bind("progress",function(t){return function(e){return t.bytesWritten=i+e.originalEvent.loaded,t._emitProgress(e)}}(this)),this._jqXHR=r.ajax(o).fail(function(t){return function(e,r,i){var n;return n=e.responseText||r||i,t._emitFail(n,e.status)}}(this)).done(function(t){return function(){return s===t.file.size?(t.options.resetAfter&&t._urlCache(!1),t._emitDone()):t._uploadFile(s)}}(this)))},t.prototype.stop=function(){return null!=this._jqXHR?this._jqXHR.abort():void 0},t.prototype._emitProgress=function(t){return null==t&&(t=null),this._deferred.notifyWith(this,[t,this.bytesWritten,this.file.size])},t.prototype._emitDone=function(){return this._deferred.resolveWith(this,[this.fileUrl,this.file])},t.prototype._emitFail=function(t,e){return this._deferred.rejectWith(this,[t,e])},t.prototype._urlCache=function(t){var e,r,i;if(r=this.options.fingerprint,null==r&&(r=this.fingerprint(this.file)),t===!1)return localStorage.removeItem(r);if(t){i=!1;try{i=localStorage.setItem(r,t)}catch(n){e=n}return i}return localStorage.getItem(r)},t.prototype.fingerprint=function(t){return"tus-"+t.name+"-"+t.type+"-"+t.size},t}(),e.exports=i}).call(this)},{jquery:"jquery"}],6:[function(t,e,r){!function(t){if("object"==typeof r)e.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var i;try{i=window}catch(n){i=self}i.SparkMD5=t()}}(function(){"use strict";var t=function(t,e){return t+e&4294967295},e=function(e,r,i,n,o,s){return r=t(t(r,e),t(n,s)),t(r<<o|r>>>32-o,i)},r=function(t,r,i,n,o,s,u){return e(r&i|~r&n,t,r,o,s,u)},i=function(t,r,i,n,o,s,u){return e(r&n|i&~n,t,r,o,s,u)},n=function(t,r,i,n,o,s,u){return e(r^i^n,t,r,o,s,u)},o=function(t,r,i,n,o,s,u){return e(i^(r|~n),t,r,o,s,u)},s=function(e,s){var u=e[0],h=e[1],l=e[2],f=e[3];u=r(u,h,l,f,s[0],7,-680876936),f=r(f,u,h,l,s[1],12,-389564586),l=r(l,f,u,h,s[2],17,606105819),h=r(h,l,f,u,s[3],22,-1044525330),u=r(u,h,l,f,s[4],7,-176418897),f=r(f,u,h,l,s[5],12,1200080426),l=r(l,f,u,h,s[6],17,-1473231341),h=r(h,l,f,u,s[7],22,-45705983),u=r(u,h,l,f,s[8],7,1770035416),f=r(f,u,h,l,s[9],12,-1958414417),l=r(l,f,u,h,s[10],17,-42063),h=r(h,l,f,u,s[11],22,-1990404162),u=r(u,h,l,f,s[12],7,1804603682),f=r(f,u,h,l,s[13],12,-40341101),l=r(l,f,u,h,s[14],17,-1502002290),h=r(h,l,f,u,s[15],22,1236535329),u=i(u,h,l,f,s[1],5,-165796510),f=i(f,u,h,l,s[6],9,-1069501632),l=i(l,f,u,h,s[11],14,643717713),h=i(h,l,f,u,s[0],20,-373897302),u=i(u,h,l,f,s[5],5,-701558691),f=i(f,u,h,l,s[10],9,38016083),l=i(l,f,u,h,s[15],14,-660478335),h=i(h,l,f,u,s[4],20,-405537848),u=i(u,h,l,f,s[9],5,568446438),f=i(f,u,h,l,s[14],9,-1019803690),l=i(l,f,u,h,s[3],14,-187363961),h=i(h,l,f,u,s[8],20,1163531501),u=i(u,h,l,f,s[13],5,-1444681467),f=i(f,u,h,l,s[2],9,-51403784),l=i(l,f,u,h,s[7],14,1735328473),h=i(h,l,f,u,s[12],20,-1926607734),u=n(u,h,l,f,s[5],4,-378558),f=n(f,u,h,l,s[8],11,-2022574463),l=n(l,f,u,h,s[11],16,1839030562),h=n(h,l,f,u,s[14],23,-35309556),u=n(u,h,l,f,s[1],4,-1530992060),f=n(f,u,h,l,s[4],11,1272893353),l=n(l,f,u,h,s[7],16,-155497632),h=n(h,l,f,u,s[10],23,-1094730640),u=n(u,h,l,f,s[13],4,681279174),f=n(f,u,h,l,s[0],11,-358537222),l=n(l,f,u,h,s[3],16,-722521979),h=n(h,l,f,u,s[6],23,76029189),u=n(u,h,l,f,s[9],4,-640364487),f=n(f,u,h,l,s[12],11,-421815835),l=n(l,f,u,h,s[15],16,530742520),h=n(h,l,f,u,s[2],23,-995338651),u=o(u,h,l,f,s[0],6,-198630844),f=o(f,u,h,l,s[7],10,1126891415),l=o(l,f,u,h,s[14],15,-1416354905),h=o(h,l,f,u,s[5],21,-57434055),u=o(u,h,l,f,s[12],6,1700485571),f=o(f,u,h,l,s[3],10,-1894986606),l=o(l,f,u,h,s[10],15,-1051523),h=o(h,l,f,u,s[1],21,-2054922799),u=o(u,h,l,f,s[8],6,1873313359),f=o(f,u,h,l,s[15],10,-30611744),l=o(l,f,u,h,s[6],15,-1560198380),h=o(h,l,f,u,s[13],21,1309151649),u=o(u,h,l,f,s[4],6,-145523070),f=o(f,u,h,l,s[11],10,-1120210379),l=o(l,f,u,h,s[2],15,718787259),h=o(h,l,f,u,s[9],21,-343485551),e[0]=t(u,e[0]),e[1]=t(h,e[1]),e[2]=t(l,e[2]),e[3]=t(f,e[3])},u=function(t){var e,r=[];for(e=0;64>e;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r},h=function(t){var e,r=[];for(e=0;64>e;e+=4)r[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return r},l=function(t){var e,r,i,n,o,h,l=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;l>=e;e+=64)s(f,u(t.substring(e-64,e)));for(t=t.substring(e-64),r=t.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;r>e;e+=1)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(s(f,i),e=0;16>e;e+=1)i[e]=0;return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),h=parseInt(n[1],16)||0,i[14]=o,i[15]=h,s(f,i),f},f=function(t){var e,r,i,n,o,u,l=t.length,f=[1732584193,-271733879,-1732584194,271733878];for(e=64;l>=e;e+=64)s(f,h(t.subarray(e-64,e)));for(t=l>e-64?t.subarray(e-64):new Uint8Array(0),r=t.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;r>e;e+=1)i[e>>2]|=t[e]<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(s(f,i),e=0;16>e;e+=1)i[e]=0;return n=8*l,n=n.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),u=parseInt(n[1],16)||0,i[14]=o,i[15]=u,s(f,i),f},a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(t){var e,r="";for(e=0;4>e;e+=1)r+=a[t>>8*e+4&15]+a[t>>8*e&15];return r},c=function(t){var e;for(e=0;e<t.length;e+=1)t[e]=p(t[e]);return t.join("")},d=function(t){return c(l(t))},y=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==d("hello")&&(t=function(t,e){var r=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(r>>16);return i<<16|65535&r}),y.prototype.append=function(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),this.appendBinary(t),this},y.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,r=this._buff.length;for(e=64;r>=e;e+=64)s(this._state,u(this._buff.substring(e-64,e)));return this._buff=this._buff.substr(e-64),this},y.prototype.end=function(t){var e,r,i=this._buff,n=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;n>e;e+=1)o[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(o,n),r=t?this._state:c(this._state),this.reset(),r},y.prototype._finish=function(t,e){var r,i,n,o=e;if(t[o>>2]|=128<<(o%4<<3),o>55)for(s(this._state,t),o=0;16>o;o+=1)t[o]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),n=parseInt(r[1],16)||0,t[14]=i,t[15]=n,s(this._state,t)},y.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},y.hash=function(t,e){/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t)));var r=l(t);return e?r:c(r)},y.hashBinary=function(t,e){var r=l(t);return e?r:c(r)},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(t){var e,r=this._concatArrayBuffer(this._buff,t),i=r.length;for(this._length+=t.byteLength,e=64;i>=e;e+=64)s(this._state,h(r.subarray(e-64,e)));return this._buff=i>e-64?r.subarray(e-64):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(t){var e,r,i=this._buff,n=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;n>e;e+=1)o[e>>2]|=i[e]<<(e%4<<3);return this._finish(o,n),r=t?this._state:c(this._state),this.reset(),r},y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._concatArrayBuffer=function(t,e){var r=t.length,i=new Uint8Array(r+e.byteLength);return i.set(t),i.set(new Uint8Array(e),r),i},y.ArrayBuffer.hash=function(t,e){var r=f(new Uint8Array(t));return e?r:c(r)},y})},{}]},{},[1]);