// Generated by CoffeeScript 1.8.0
(function() {
  var $, Q, ResumableUpload, tus;

  $ = require("jquery");

  ResumableUpload = require("./ResumableUpload.coffee");

  tus = require("./Tus.coffee");

  Q = require("q");

  $(function() {
    var files, upload;
    upload = null;
    files = null;
    $('.js-stop').click(function(e) {
      e.preventDefault();
      if (files) {
        return tus.stopAll(files);
      }
    });
    return $('input[type=file]').change(function() {
      var $input, $parent, displayUploadedFiles, doChecksum, file, logErrors, openDialogIfFileExist, options, resetUI, startUpload, updateProgress;
      $input = $(this);
      $parent = $input.parent();
      files = this.files;
      file = files[0];
      $('.js-stop').removeClass('disabled');
      $('.progress').addClass('active');
      options = {
        endpoint: 'http://localhost:1080/files/',
        resetBefore: $('#reset_before').prop('checked'),
        resetAfter: true,
        chunkSize: 1,
        minChunkSize: 51200,
        maxChunkSize: 2097152,
        path: ""
      };
      openDialogIfFileExist = function(error) {
        if (confirm("Some files are on server. Do you want to overwrite files?")) {
          return true;
        } else {
          return Q.reject(error);
        }
      };
      doChecksum = function() {
        if ($('#checksum').prop('checked')) {
          return tus.checksumAll(files, options);
        }
      };
      startUpload = function() {
        return tus.uploadAll(files, options);
      };
      displayUploadedFiles = function(result) {
        var $download, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = files.length; _i < _len; _i++) {
          file = files[_i];
          $download = $("<a>Download " + file.name + " (" + file.size + " bytes " + file.md5 + ")</a><br />").appendTo($parent);
          $download.attr('href', result.url);
          _results.push($download.addClass('btn').addClass('btn-success'));
        }
        return _results;
      };
      updateProgress = function(result) {
        return $('.progress-bar').css('width', "" + result.value.percentage + "%");
      };
      logErrors = function(error) {
        return console.log(error);
      };
      resetUI = function() {
        return $('.js-stop').addClass('disabled');
      };
      return tus.checkAll(files, options)["catch"](openDialogIfFileExist).then(doChecksum).then(startUpload).then(displayUploadedFiles).progress(updateProgress)["catch"](logErrors).fin(resetUI);
    });
  });

}).call(this);

//# sourceMappingURL=app.js.map
